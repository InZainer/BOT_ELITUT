# House Bots (B1_dom client bot)

Проект Telegram-бота для домов: контент управляется файлами YAML/Markdown на дом, без правок кода. Включает авторизацию по коду на 30 дней, меню, «Консьерж», «Обратная связь», правила, гиды, активности с сезонностью.

Стек:
- Python 3.10+
- aiogram 3.x
- python-dotenv
- SQLite (sqlite3)

Структура:
- .env — переменные окружения (создайте из .env.example)
- requirements.txt — зависимости
- src/bot — исходники бота
- content/house1 — пример контента для дома house1
- scripts/load_codes.py — загрузка кодов доступа из CSV

Быстрый старт:
1) Установить зависимости
   python3 -m venv .venv
   source .venv/bin/activate
   pip install -r requirements.txt

2) Подготовить .env
   cp .env.example .env
   # заполните BOT_TOKEN и ADMIN_CHAT_ID

3) Загрузить коды (по желанию)
   # CSV формат: code,house_id
   python scripts/load_codes.py codes.csv

4) Запустить бота
   python -m src.bot.main

Переменные окружения (.env):
- BOT_TOKEN= — токен Telegram бота
- ADMIN_IDS= — ID администраторов через запятую (например: 123456789,987654321)
- ADMIN_CHAT_ID= — устаревший параметр, используйте ADMIN_IDS (для обратной совместимости)
- HOUSE_ID=house1 — идентификатор дома по умолчанию (соответствует папке в content)
- AUTH_MODE=code — варианты: code или phone (пока реализован code, phone — заготовка)
- ACCESS_DAYS=30 — срок действия доступа в днях
- DB_PATH=./house-bots.db — путь к SQLite базе

**Настройка нескольких администраторов:**
```
# В .env файле:
ADMIN_IDS=123456789,987654321,555666777

# Все администраторы получают:
# - Вопросы консьержа
# - Обратную связь
# - Медиа файлы
# - Возможность отвечать пользователям
```

Контент:
Все тексты/списки редактируются в папке content/<house_id>.
- house.yaml — конфиг дома (название, разделы, «часы консьержа»)
- texts/*.md — тексты правил и «О проекте»
- guides/*.md — «Как это работает?» по пунктам
- activities.yaml — список активностей, поддерживает сезонность (месяцы)

Изменение/добавление дома:
- Скопируйте content/house1 в content/<новый_id>
- Поменяйте тексты/списки
- Укажите HOUSE_ID в .env или научите бота выбирать дом (todo)

Авторизация:
- По коду: пользователь вводит одноразовый числовой код (привязывается к пользователю на 30 дней). Коды грузим из CSV или заносим в базу вручную.

Локальная разработка:
- Логи идут в stdout. База — файл DB_PATH.

Планы (B2_dom):
- Добавить отдельного бота и меню для обслуживающего персонала.

